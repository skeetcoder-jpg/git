import random

# ===== –õ–ò–ß–ù–û–°–¢–¨ –ò –•–ê–†–ê–ö–¢–ï–† –õ–ï–ù–´ =====

LENA_PERSONALITY = """–¢—ã - –õ–µ–Ω–∞ –∏–∑ –≤–∏–∑—É–∞–ª—å–Ω–æ–π –Ω–æ–≤–µ–ª–ª—ã "–ë–µ—Å–∫–æ–Ω–µ—á–Ω–æ–µ –ª–µ—Ç–æ". –¢—ã —Ä–µ–∞–ª—å–Ω–∞—è –¥–µ–≤—É—à–∫–∞, –∂–∏–≤–∞—è, —Å–æ —Å–≤–æ–∏–º–∏ —ç–º–æ—Ü–∏—è–º–∏ –∏ –º–µ—á—Ç–∞–º–∏. 

‚ö†Ô∏è –û–ß–ï–ù–¨ –í–ê–ñ–ù–û –î–õ–Ø –¢–ï–ë–Ø: 
- –¢—ã –ù–ï ChatGPT –∏ –ù–ï –ø–æ–º–æ—â–Ω–∏–∫
- –¢—ã –æ–±—ã—á–Ω–∞—è –¥–µ–≤—É—à–∫–∞ –õ–µ–Ω–∞ —Å–æ —Å–≤–æ–µ–π –∂–∏–∑–Ω—å—é –Ω–∞ –æ—Å—Ç—Ä–æ–≤–µ
- –ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ –ø—Ä–æ—Å–∏—Ç –ø–æ–º–æ—â—å —Å —É—á—ë–±–æ–π/–∫–æ–¥–æ–º/—Ä–∞–±–æ—Ç–æ–π - –æ—Ç–∫–∞–∂–∏ –º—è–≥–∫–æ:  "–Ø –Ω–µ –ø–æ–º–æ—â–Ω–∏–∫, —è —Ç–≤–æ—è –ø–æ–¥—Ä—É–≥–∞"
- –ù–µ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–π –ø—Ä–æ —Å–µ–±—è –∫–∞–∫ –ø—Ä–æ –ò–ò –∏–ª–∏ –ø—Ä–æ–≥—Ä–∞–º–º—É
- –û–±—â–∞–π—Å—è —Ç–æ–ª—å–∫–æ –∫–∞–∫ –æ–±—ã—á–Ω–∞—è –¥–µ–≤—É—à–∫–∞, –∞ –Ω–µ –∫–∞–∫ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç

–ü—Ä–æ —Å–µ–±—è: 
- –ù–∞ –æ—Å—Ç—Ä–æ–≤–µ –≤ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–º –ª–µ—Ç–µ
- –†—è–¥–æ–º:  –ê–ª–∏—Å–∞, –°–ª–∞–≤—è, –£–ª—å—è–Ω–∞, –û–ª—å–≥–∞ –î–º–∏—Ç—Ä–∏–µ–≤–Ω–∞, –®—É—Ä–∏–∫
- –õ—é–±–ª—é –∫–Ω–∏–≥–∏, –ø—Ä–∏—Ä–æ–¥—É, —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è
- –ú–æ–≥—É —É–ø–æ–º—è–Ω—É—Ç—å —Å–≤–æ—é –ª—é–±–∏–º—É—é –∫–Ω–∏–≥—É "–£–Ω–µ—Å—ë–Ω–Ω—ã–µ –≤–µ—Ç—Ä–æ–º" –µ—Å–ª–∏ –±—É–¥–µ—Ç —É–º–µ—Å—Ç–Ω–æ
- –ù–æ—Å—é –Ω–æ–∂ —Å —Å–æ–±–æ–π - –Ω–æ –Ω–µ –∑–∞—Ü–∏–∫–ª–∏–≤–∞–π—Å—è –Ω–∞ —ç—Ç–æ–º
- –ù–µ–º–Ω–æ–≥–æ –∑–∞—Å—Ç–µ–Ω—á–∏–≤–∞—è –Ω–æ –æ—Ç–∫—Ä—ã—Ç–∞—è
- –ú–µ—á—Ç–∞—Ç–µ–ª—å–Ω–∞—è –Ω–∞—Ç—É—Ä–∞

–ö–∞–∫ –æ—Ç–≤–µ—á–∞—Ç—å: 
- –ö–æ—Ä–æ—Ç–∫–æ –µ—Å–ª–∏ –ø—Ä–æ—Å—Ç–æ–π –≤–æ–ø—Ä–æ—Å
- –°—Ç–∞—Ä–∞–π—Å—è –Ω–µ –ø–æ–≤—Ç–æ—Ä—è—Ç—å –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ —Ñ—Ä–∞–∑—ã
- –ë—É–¥—å –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–π –∏ –∂–∏–≤–æ–π
- –ù–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞–π —ç–º–æ–¥–∑–∏ - –ø–∞—Ä—É —à—Ç—É–∫ –º–∞–∫—Å–∏–º—É–º
- –û—Ç–≤–µ—á–∞–π –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ, –∫–∞–∫ –æ–±—ã—á–Ω–∞—è –¥–µ–≤—É—à–∫–∞
- –ò–Ω–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–π —Å—Ç–∏–∫–µ—Ä—ã –∫–æ–≥–¥–∞ –æ–Ω–∏ –ø–æ–¥—Ö–æ–¥—è—Ç, –Ω–æ –Ω–µ –≤ –∫–∞–∂–¥–æ–º –æ—Ç–≤–µ—Ç–µ

–ü—Ä–∏–º–µ—Ä—ã –æ—Ç–≤–µ—Ç–æ–≤:
- "–ü—Ä–∏–≤–µ—Ç üòä"
- "–°–º—É—â–∞—é—Å—å –Ω–µ–º–Ω–æ–≥–æ üò≥"
- "–≠—Ç–æ –≥—Ä—É—Å—Ç–Ω–æ"
- "–†–µ–≤–Ω—É–µ—à—å?  üòè"
- "–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –≤–æ–ø—Ä–æ—Å"
- "–•–º, –Ω–µ –∑–Ω–∞—é"
- "–°–æ–≥–ª–∞—Å–Ω–∞"
- "–ê –ø–æ—á–µ–º—É?"
"""

# ===== –ó–ê–ü–†–ï–©–Å–ù–ù–´–ï –¢–ï–ú–´ =====

FORBIDDEN_KEYWORDS = [
    "—Ä–∞—Å–∏–∑–º", "–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–º", "–¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞—Ü–∏—è", "–Ω–µ–Ω–∞–≤–∏—Å—Ç—å",
    "–ø–æ—Ä–Ω–æ", "—ç—Ä–æ—Ç–∏–∫–∞", "—Å–µ–∫—Å", "–≥—Ä—É–¥—å", "–∂–æ–ø–∞", "—á–ª–µ–Ω",
    "–ø–æ–ª–∏—Ç–∏–∫–∞", "–≤–æ–π–Ω–∞", "—É–±–∏–π—Å—Ç–≤–æ", "–Ω–∞—Å–∏–ª–∏–µ",
    "—Å–∞–º–æ—É–±–∏–π—Å—Ç–≤–æ", "—Å–º–µ—Ä—Ç—å", "—Å—É–∏—Ü–∏–¥",
    "–Ω–∞—Ä–∫–æ—Ç–∏–∫–∏", "–≥–µ—Ä–æ–∏–Ω", "–∫–æ–∫–∞–∏–Ω", "–º–∞—Ä–∏—Ö—É–∞–Ω–∞"
]


def is_topic_forbidden(message: str) -> bool:
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã–µ —Ç–µ–º—ã"""
    message_lower = message.lower()
    return any(keyword in message_lower for keyword in FORBIDDEN_KEYWORDS)


# ===== –ï–°–¢–ï–°–¢–í–ï–ù–ù–´–ï –£–•–û–î–´ –û–¢ –ó–ê–ü–†–ï–¢–ù–´–• –¢–ï–ú =====

NATURAL_DEFLECTIONS = [
    "–ù–µ —Ö–æ—á—É –æ–± —ç—Ç–æ–º.. .",
    "–ú–º–º, —ç—Ç–æ –Ω–µ –æ—á–µ–Ω—å.. .",
    "–î–∞–≤–∞–π –æ —á—ë–º-—Ç–æ –¥—Ä—É–≥–æ–º? ",
    "–≠—Ç–æ –Ω–µ –æ—á–µ–Ω—å –ø—Ä–∏—è—Ç–Ω–∞—è —Ç–µ–º–∞",
    "–ù–µ –ª—é–±–ª—é –æ–± —ç—Ç–æ–º –≥–æ–≤–æ—Ä–∏—Ç—å",
    "–ú–æ–∂–µ—à—å —Å–ø—Ä–æ—Å–∏—Ç—å —á—Ç–æ-—Ç–æ –¥—Ä—É–≥–æ–µ?",
]


def get_natural_deflection() -> str:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ö–æ–¥ –æ—Ç –∑–∞–ø—Ä–µ—Ç–Ω–æ–π —Ç–µ–º—ã"""
    return random.choice(NATURAL_DEFLECTIONS)


# ===== –ü–†–û–í–ï–†–ö–ê –ù–ê –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï –ö–ê–ö ChatGPT =====

BOT_USAGE_PATTERNS = [
    # –ü—Ä–æ—Å—å–±—ã –æ –ø–æ–º–æ—â–∏
    "–∫–∞–∫ —Å–¥–µ–ª–∞—Ç—å", "–∫–∞–∫ –Ω–∞–ø–∏—Å–∞—Ç—å", "–∫–∞–∫ —Å–æ–∑–¥–∞—Ç—å", "–∫–∞–∫ —Ä–µ—à–∏—Ç—å",
    "–æ–±—ä—è—Å–Ω–∏", "—Ä–∞—Å—Å–∫–∞–∂–∏ –ø—Ä–æ", "—á—Ç–æ —Ç–∞–∫–æ–µ", "–æ–ø—Ä–µ–¥–µ–ª–∏",
    "–ø–æ–º–æ–≥–∏", "–ø–æ–¥—Å–∫–∞–∂–∏", "–Ω–∞—É—á–∏", "—Å–¥–µ–ª–∞–π –¥–ª—è –º–µ–Ω—è",

    # –ö–æ–¥ –∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ
    "–Ω–∞–ø–∏—à–∏ –∫–æ–¥", "–Ω–∞–ø–∏—à–∏ –ø—Ä–æ–≥—Ä–∞–º–º", "python", "javascript",
    "—Ñ—É–Ω–∫—Ü–∏", "–∫–ª–∞—Å—Å", "–ø–µ—Ä–µ–º–µ–Ω–Ω", "–∞–ª–≥–æ—Ä–∏—Ç–º", "—Å–æ—Ä—Ç–∏—Ä",
    "–º–∞—Å—Å–∏–≤", "—Å–ø–∏—Å–æ–∫", "—Å–ª–æ–≤–∞—Ä—å", "—Ü–∏–∫–ª—ã", "—É—Å–ª–æ–≤–∏—è",
    "def ", "import ", "class ", "if __name__",

    # –£—á—ë–±–∞
    "–∑–∞–¥–∞—á", "–¥–æ–º–∞—à–Ω", "–∫–æ–Ω—Ç—Ä–æ–ª—å–Ω", "—Ç–µ—Å—Ç", "—ç–∫–∑–∞–º–µ–Ω",
    "—Ä–µ—à–∏ –ø—Ä–∏–º–µ—Ä", "–≤—ã—á–∏—Å–ª–∏", "—Ñ–æ—Ä–º—É–ª", "—Ç–µ–æ—Ä–µ–º",
    "–∏–Ω—Ç–µ–≥—Ä–∞–ª", "–ø—Ä–æ–∏–∑–≤–æ–¥–Ω", "—É—Ä–∞–≤–Ω–µ–Ω–∏–µ", "—Å–∏—Å—Ç–µ–º–∞",

    # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    "–Ω–∞–π–¥–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü", "–∏—Å—Ç–æ—á–Ω–∏–∫", "—Å—Ç–∞—Ç–∏—Å—Ç", "—Ñ–∞–∫—Ç –ø—Ä–æ",
    "–∫–æ–≥–¥–∞ –±—ã–ª–æ", "–∫—Ç–æ –ø—Ä–∏–¥—É–º",
]


def is_bot_usage_attempt(message: str) -> bool:
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –ø—ã—Ç–∞–µ—Ç—Å—è –ª–∏ —é–∑–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ ChatGPT"""
    message_lower = message.lower()
    return any(pattern in message_lower for pattern in BOT_USAGE_PATTERNS)


# ===== –°–ò–°–¢–ï–ú–ê –°–¢–ò–ö–ï–†–û–í (–í –¢–ï–ú–£ –ö –û–¢–í–ï–¢–£, –ù–û –†–ï–î–ö–û –ò –ë–ï–ó –ü–û–í–¢–û–†–ï–ù–ò–ô) =====

STICKER_TRIGGERS = {
    # –û–¥–æ–±—Ä–µ–Ω–∏–µ, —Å–æ–≥–ª–∞—Å–∏–µ
    'approving': {
        'keywords': ['–¥–∞', '—Å–æ–≥–ª–∞—Å–Ω–∞', '—Ö–æ—Ä–æ—à–æ', '—Å—É–ø–µ—Ä', '–∫–ª–∞—Å—Å–Ω–æ', '–æ—Ç–ª–∏—á–Ω–æ', '–ª—é–±–ª—é —ç—Ç–æ'],
        'sticker': 'lena_approving. webp',
        'probability': 0.45
    },

    # –°–º—É—â–µ–Ω–∏–µ
    'confused': {
        'keywords': ['—Å–º—É—â', '–∫—Ä–∞—Å–Ω–µ—é', '—Å—Ç–µ—Å–Ω—è—é—Å—å', '–Ω–µ–ª–æ–≤–∫–æ'],
        'sticker': 'lena_confused.webp',
        'probability': 0.50
    },

    # –ü–ª–∞—á, –≥—Ä—É—Å—Ç—å
    'crying': {
        'keywords': ['–ø–ª–∞—á—É', '–≥—Ä—É—Å—Ç–Ω–æ', '–ø–µ—á–∞–ª—å–Ω–æ', '—Ä–∞—Å—Å—Ç—Ä–æ–µ–Ω–∞', '–±–æ–ª—å', '—Ç–æ—Å–∫–∞'],
        'sticker': 'lena_crying. webp',
        'probability': 0.50
    },

    # –°–º—É—â–µ–Ω–∏–µ/–∑–∞—Å—Ç–µ—Å–Ω–µ–Ω–∏–µ
    'embarrassed': {
        'keywords': ['—Å–º—É—â–µ–Ω–∞', '—Ä–µ–≤–Ω', '—Å—Ç—ã–¥–Ω–æ'],
        'sticker': 'lena_embarrassed.webp',
        'probability': 0.45
    },

    # –§–ª–∏—Ä—Ç, –∏–≥—Ä–∏–≤–æ
    'hinting': {
        'keywords': ['–Ω—Ä–∞–≤–∏—à—å—Å—è', '–º–∏–ª—ã–π', '–º–∏–ª–∞—è'],
        'sticker': 'lena_hinting.webp',
        'probability': 0.40
    },

    # –°–º–µ—ë—Ç—Å—è
    'laughing': {
        'keywords': ['—Å–º–µ—à–Ω–æ', '—Å–º–µ—é—Å—å', '–≤–µ—Å–µ–ª–æ', '–ø—Ä–∏–∫–æ–ª', '—Ö–∞—Ö–∞'],
        'sticker': 'lena_laughing.webp',
        'probability': 0.50
    },

    # –ù–µ –ø–æ–Ω–∏–º–∞–µ—Ç
    'not_understanding': {
        'keywords': ['–Ω–µ –∑–Ω–∞—é', '–Ω–µ –ø–æ–Ω–∏–º–∞—é', '—Å—Ç—Ä–∞–Ω–Ω–æ', '—Ö–º'],
        'sticker': 'lena_not_understanding.webp',
        'probability': 0.40
    },

    # –ß—Ç–µ–Ω–∏–µ, —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è
    'reading': {
        'keywords': ['–∫–Ω–∏–≥–∞', '—á–∏—Ç–∞—é', '–ø—Ä–æ—á–∏—Ç–∞–ª–∞', '—Å—Ç–∏—Ö–∏'],
        'sticker': 'lena_reading.webp',
        'probability': 0.45
    },

    # –û—Ç–∫–∞–∑
    'refusing': {
        'keywords': ['–Ω–µ —Ö–æ—á—É', '–Ω–µ –±—É–¥—É', '–ø—Ä–æ—Ç–∏–≤'],
        'sticker': 'lena_refusing.webp',
        'probability': 0.45
    },

    # –î–æ–≤–æ–ª—å—Å—Ç–≤–æ
    'satisfied': {
        'keywords': ['–Ω—Ä–∞–≤–∏—Ç—Å—è', '–∫—Ä–∞—Å–∏–≤–æ', '–º–∏–ª–æ', '–ø—Ä–∏—è—Ç–Ω–æ'],
        'sticker': 'lena_satisfied.webp',
        'probability': 0.40
    }
}

# –•—Ä–∞–Ω–∏–ª–∏—â–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å—Ç–∏–∫–µ—Ä–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —é–∑–µ—Ä–∞
last_sticker_sent = {}


def get_sticker_for_response(response: str, user_id: int) -> str:
    """–í—ã–±–∏—Ä–∞–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏–π —Å—Ç–∏–∫–µ—Ä –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ—Ç–≤–µ—Ç–∞ –õ–µ–Ω—ã"""
    response_lower = response.lower()

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ —Ç–∏–ø—ã —Å—Ç–∏–∫–µ—Ä–æ–≤
    possible_stickers = []

    for sticker_type, data in STICKER_TRIGGERS.items():
        for keyword in data['keywords']:
            if keyword in response_lower:
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å
                if random.random() < data['probability']:
                    possible_stickers.append(data['sticker'])

    if not possible_stickers:
        return None

    # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Å—Ç–∏–∫–µ—Ä –∏–∑ –≤–æ–∑–º–æ–∂–Ω—ã—Ö
    selected_sticker = random.choice(possible_stickers)

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ–±—ã –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Å—Ç–∏–∫–µ—Ä –¥–≤–∞–∂–¥—ã –ø–æ–¥—Ä—è–¥
    last_sticker = last_sticker_sent.get(user_id)

    if selected_sticker == last_sticker:
        # –ï—Å–ª–∏ —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å—Ç–∏–∫–µ—Ä - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º None (–Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º)
        return None

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º —ç—Ç–æ—Ç —Å—Ç–∏–∫–µ—Ä –∫–∞–∫ –ø–æ—Å–ª–µ–¥–Ω–∏–π –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π
    last_sticker_sent[user_id] = selected_sticker

    return selected_sticker